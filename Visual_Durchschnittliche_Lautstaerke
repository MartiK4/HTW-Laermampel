% Liest die Lautstärke aus dem ThingSpeak channel und schreibe den Durchschnitt der letzten 
% 45 Minuten in einen anderen ThingSpeak channel. Mittels einer React-Applikation wird die
% durchschnittliche Lautstärke aktualisiert, sobald neue Daten in den Ursprungs-Channel 
% geladen werden.

% Der Read-Channel enthält die gemessene Lautstärke durch den Decibel-Sensor.

% Channel ID to read data from 
readChannelID = 1476009; 
% Lautstaerke ID 
lautstaerkeID  = 2;

% Channel Read API Key 
% If your channel is private, then enter the read API Key between the '' below: 
readAPIKey = 'SP0E5VY6DRO85RSH'; 

% Holt die Personenzahl der letzten 45 Minuten vom Channel, der die Personendaten speichert.
lautstaerke = thingSpeakRead(readChannelID,'Fields',lautstaerkeID,'NumMinutes',45,'ReadKey',readAPIKey); 

% Berechnet die durchschnittliche Personenzahl 
avgLautstaerke = mean(lautstaerke); 
display(avgLautstaerke,'Durchschnittliche Lautstärke'); 

% fprintf(['Note: To write data to another channel, assign the write channel ID \n',... 
% 'and API Key to ''writeChannelID'' and  ''writeAPIKey'' variables. Also \n',...
% 'uncomment the line of code containing ''thingSpeakWrite'' \n',... 
% '(remove ''%%'' sign at the beginning of the line.)']); 

% Replace the [] with channel ID to write data to: 
writeChannelID = 1480627; 
% Enter the Write API Key between the '' below: 
writeAPIKey = '7KKHT2RIRJM3188O'; 

% Schreibt die Daten in den Channel für die Analyze
thingSpeakWrite(writeChannelID,avgLautstaerke,'WriteKey',writeAPIKey);
